# Регистрация и авторизация пользователей

*Автор - **[Игнатьев Кирилл](https://github.com/goldenchest19)***

Микросервис реализует регистрацию и авторизацию пользователя, с возможность авторизации по токену без пароля

## Инструкция по запуску микросервиса
Вам потребуется java не ниже 17 версии

Для запуска вы можете скачать [croc-registrarion.jar](https://github.com/nypi/learnit/raw/main/registration/croc-registration.jar), который располагается по адресу :
```
https://github.com/nypi/learnit/blob/main/registration/croc-registration.jar
```
Затем вам необходимо, перейти в папку с jar файлом и прописать следующую команду:
```
java -jar croc-registration.jar
```
(В случае отказа в доступе на Linux, можете попробовать перенести в другую папку)

Также вы можете прописать полный путь до jar файла
```
java -jar /your/directory/croc-registration.jar
``` 
Кроме того, вы можете склонировать текущий репозиторий, загрузить зависимости из файла pom.xml и запустить проект


## Стек технологий
  1.  Java 17 
  2.  H2 DBMS
  3.  org.json


## Описание микросервиса

* Данный микросервис предоставляет возможости регистрации и авторизации пользователя в системе. При регистрации происходит валидация данных, если пользователь
  успешно проходит ее, то его данные сохраняются в базу данных,и создается поле в таблице с токенами для контроля состояние сессии.
* Для хэширования паролей используется алгоритм хэширования MD5, соответсвенно все пароли в базе данных хранятся в зашифрованном виде.
* При авторизации у пользователя спрашивается его логин и пароль, который проверяется на соответствие в базе данных. Если пользователь успешно проходит авторизацию,
  то на его компьюетере генируется токен, который записывается в базу данных. Если пользователь не выполняет logout, то в течение часа он имеет возможность авторизоваться
  с помощью токена без логина и пароля, так как цикл жизни токена составляет один час.

### Немного подробнее про работу токена
Токен создается по стандартам JWT.
1. Subject - главный идентификатор. Используется для обращения и дифференциации принадлежности токена.
2. Audantification - побочные данные, могут носить в себе данные для проверки информации для пользователя или выступать идентификаторами.
3. Exp - идентификатор срока жизни.

Всё это составляет полезную нагрузку и генерирует токен.
Данный токен создается при успешной авторизации пользователя и записывается на его компьютер и в базу данных. При каждой авторизации происходит проверка, совпадает ли токен, с токеном в базе данных. Соответственно при совпадение токенов, пользователь выполняет аунтефикацию без логина и пароля. Жизненный цикл токена составляет один час с момента авторизации пользователя.
```java
public static String createToken(String id) {
        long time = 1;

        JSONObject jwtPayload = new JSONObject();
        JSONArray audArray = new JSONArray();

        jwtPayload.put("sub", id);
        jwtPayload.put("aud", audArray);
        LocalDateTime ldt = LocalDateTime.now().plusHours(time);
        jwtPayload.put("exp", ldt.toEpochSecond(ZoneOffset.UTC));
        String token = new JWebToken(jwtPayload).toString();
        writeToken(token);
        return token;
    }
```


## Демонстрация работы микросервиса
```
Вы зарегистрированы в нашем приложение?(Необходимо ответить 'yes' или 'no')
-no
Введите ваше имя
-Кирилл
Введите вашу фамилию
-Игнатьев
Введите номер вашего телефона
-89993332211
Введите вашу электронную почту
-kirill@mail.ru
Введите логин. Логин может состоять только из латинских символов, цифр или символа '_', 
длина логина не менее 5 символов
-kirill_01
Введите ваш пароль
-tester123
Вы зарегистрированы в нашем приложение?(Необходимо ответить 'yes' или 'no')
-yes
Введите ваш логин
-kirill_01
Введите ваш пароль 
-tester123
Авторизация выполнена
Ваши данные:
Имя: Кирилл
Фамилия: Игнатьев
Номер телефон: 89993332211
Электронная почта: kirill@mail.ru
Чтобы выйти из аккаунта, напиши 'logout' 
```
Далее если пользователь не сделает logout и перезапустит программу не более чем через час, то он увидит авторизацию своего аккаунта
```
Имя: Кирилл
Фамилия: Игнатьев
Номер телефон: 89993332211
Электронная почта: kirill@mail.ru
Чтобы выйти из аккаунта, напиши 'logout' 
```
